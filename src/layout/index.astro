---
import { container, vstack } from "../../styled-system/patterns";
import Header from "./Header.astro";
import Sidebar from "./Sidebar/index.astro";
import Drawer from "./Drawer/index.astro";
import Footer from "./Footer.astro";
import Jumbotron from "./Jumbotron.astro";
import Fab from "./Fab.astro";
import PaperLink from "../components/PaperLink.astro";

interface Props {
  title?: string;
}

const { title } = Astro.props;
const siteTitle = "Astro Boy";
---

<!doctype html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="description" content="Astro description" />
    <meta name="viewport" content="width=device-width" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="generator" content={Astro.generator} />
    <title>{title ? `${title} - ${siteTitle}` : siteTitle}</title>
  </head>
  <body>
    <Header siteTitle={siteTitle} />
    <main>
      <article>
        <Jumbotron title={title || siteTitle} />
        <div
          class={container({
            maxWidth: "contentMaxWidth",
            display: "flex",
            px: 2,
            py: 4,
          })}
        >
          <div
            class={vstack({
              flexGrow: 1,
              gap: 4,
              px: [0, 2],
              alignItems: "stretch",
              maxWidth: "100%",
            })}
          >
            <slot />
            <PaperLink href="/">Top</PaperLink>
          </div>
          <div
            class={vstack({
              width: "sidebarWidth",
              gap: 4,
              display: ["none", "none", "flex"],
              flexShrink: 0,
              px: 2,
              pb: 8,
              alignItems: "stretch",
            })}
          >
            <Sidebar>
              <slot slot="sidebar-top" name="sidebar-top" />
              <slot slot="sidebar-bottom" name="sidebar-bottom" />
            </Sidebar>
          </div>
        </div>
      </article>
    </main>
    <Footer siteTitle={siteTitle} />
    <Fab />
    <Drawer />
  </body>
  <script>
    import "../scripts/toggleColorMode.ts";
  </script>
  <script is:inline>
    const theme = (() => {
      if (typeof localStorage === "undefined") return "light";

      const localStorageItem = localStorage.getItem("astro-color-mode");
      if (
        localStorageItem &&
        (localStorageItem === "light" || localStorageItem === "dark")
      ) {
        return localStorageItem;
      }
      if (window.matchMedia("(prefers-color-scheme: dark)").matches) {
        return "dark";
      }
      return "light";
    })();

    document.documentElement?.setAttribute("data-color-mode", theme);

    window.localStorage.setItem("astro-color-mode", theme);
  </script>
</html>
