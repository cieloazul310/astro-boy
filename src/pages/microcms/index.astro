---
import Layout from "../../layout/index.astro";
import PostListItem from "../../components/PostListItem.astro";
import MicrocmsCategories from "../../components/MicrocmsCategories.astro";
import { getBlogs } from "../../utils/microcms";
import parseDate from "../../utils/parseDate";
import { slugify, pubDateToYYMM } from "../../utils/slugify";
import { vstack } from "../../../styled-system/patterns";

const blogs = await getBlogs({ fields: ["id", "title", "publishedAt"] });
---

<Layout title="microCMS Posts">
  <ul class={vstack({ gap: 2, alignItems: "stretch" })}>
    {
      blogs.contents
        .sort(
          (a, b) =>
            new Date(b.publishedAt).getTime() -
            new Date(a.publishedAt).getTime(),
        )
        .map(({ id, title, publishedAt }) => (
          <PostListItem
            href={`/microcms/${slugify({ id, ...pubDateToYYMM(publishedAt) })}`}
            title={title}
            author={id}
            date={parseDate(publishedAt)}
          />
        ))
    }
  </ul>
  <MicrocmsCategories slot="sidebar-top" />
  <MicrocmsCategories slot="drawer-top" />
</Layout>
