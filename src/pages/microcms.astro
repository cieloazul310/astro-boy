---
import Layout from "../layout/index.astro";
import PostListItem from "../components/PostListItem.astro";
import { getBlogs } from "../scripts/microcms";
import parseDate from "../utils/parseDate";
import { slugify, pubDateToYYMM } from "../utils/slugify";
import { vstack } from "../../styled-system/patterns";

const response = await getBlogs({ fields: ["id", "title", "publishedAt"] });
---

<Layout title="MicroCMS Posts">
  <ul class={vstack({ m: 0, p: 0, gap: 2, alignItems: "stretch" })}>
    {
      response.contents
        .sort(
          (a, b) =>
            new Date(b.publishedAt).getTime() -
            new Date(a.publishedAt).getTime(),
        )
        .map(({ id, title, publishedAt }) => (
          <PostListItem
            href={`/${slugify({ id, ...pubDateToYYMM(publishedAt) })}`}
            title={title}
            author={id}
            date={parseDate(publishedAt)}
          />
        ))
    }
  </ul>
</Layout>
